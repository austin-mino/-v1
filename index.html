<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>ğŸ’£ ì§€ë¢°ì°¾ê¸°</title>
<style>
  /* â”€â”€â”€ ìƒ‰ìƒ í† í° â”€â”€â”€ */
  :root{
    --bg:#1a1a1a; --cell:#333; --text:#f0f0f0;
    --rev:#555;   --mine:#e74c3c; --flag:#2ecc71;
    --cell-size:40px;
  }
  body.light{
    --bg:#f0f0f0; --cell:#ddd; --text:#1a1a1a;
    --rev:#eee;   --mine:#e74c3c; --flag:#27ae60;
  }
  /* ëª¨ë°”ì¼-ê°€ë³€ ì…€ í¬ê¸° */
  @media(max-width:600px){:root{--cell-size:32px}}
  @media(max-width:420px){:root{--cell-size:26px}}
  @media(max-width:360px){:root{--cell-size:22px}}

  /* â”€â”€â”€ ê¸°ë³¸ ìŠ¤íƒ€ì¼ â”€â”€â”€ */
  body{
    margin:0;padding:20px;text-align:center;
    background:var(--bg);color:var(--text);
    font-family:'Segoe UI',sans-serif;
    transition:background .3s,color .3s;
  }
  h1{color:#00bcd4;margin-top:0}
  #controls{margin-bottom:10px}
  #board{
    display:grid;gap:2px;justify-content:center;margin-top:16px;
    touch-action:none; /* iOS ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ */
  }
  .cell{
    width:var(--cell-size);height:var(--cell-size);
    background:var(--cell);border-radius:6px;
    display:flex;align-items:center;justify-content:center;
    color:var(--text);font-size:calc(var(--cell-size)*0.5);
    user-select:none;transition:background .15s;
  }
  .revealed{background:var(--rev)}
  .mine{background:var(--mine)}
  .flagged{background:var(--flag)}
  #themeToggle{
    position:fixed;top:16px;right:16px;
    background:#00bcd4;border:none;border-radius:6px;
    color:#fff;padding:8px 12px;cursor:pointer
  }
  #winMessage{display:none;font-size:1.5rem;color:#4caf50;margin-top:10px}
</style>
</head>
<body>
<button id="themeToggle">ğŸŒ™ í…Œë§ˆ</button>
<h1>ğŸ’£ ì§€ë¢°ì°¾ê¸°</h1>

<div id="controls">
  ë‚œì´ë„:
  <select id="difficulty">
    <option value="easy">ì‰¬ì›€ (8Ã—8, 10)</option>
    <option value="medium" selected>ë³´í†µ (10Ã—10, 15)</option>
    <option value="hard">ì–´ë ¤ì›€ (12Ã—12, 25)</option>
  </select>
  <button id="startBtn">ê²Œì„ ì‹œì‘</button>
  <button id="resetBtn">ğŸ”„ ì¬ì‹œì‘</button>
  <p>â± <span id="timer">0</span>ì´ˆ | ğŸ´ <span id="flagsLeft">0</span></p>
  <div id="winMessage">ğŸ‰ ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!</div>
</div>

<div id="board"></div>

<script>
/* â”€â”€â”€ DOM â”€â”€â”€ */
const board       = document.getElementById('board');
const timerDOM    = document.getElementById('timer');
const flagsDOM    = document.getElementById('flagsLeft');
const diffSelect  = document.getElementById('difficulty');
const winMessage  = document.getElementById('winMessage');
const startBtn    = document.getElementById('startBtn');
const resetBtn    = document.getElementById('resetBtn');
/* â”€â”€â”€ ê²Œì„ ìƒíƒœ â”€â”€â”€ */
let size=10, mines=15, cells=[], flagsLeft=0;
let firstClick=true, revealed=0, timer=0, tHandle;

/* â”€â”€â”€ ëª¨ë°”ì¼ long-press í”Œë˜ê·¸ìš© â”€â”€â”€ */
const LONG=500; //ms

/* â”€â”€â”€ í—¬í¼ â”€â”€â”€ */
const idx=(x,y)=>y*size+x;

/* â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€ */
startBtn.onclick = generate;
resetBtn.onclick = resetGame;
document.getElementById('themeToggle').onclick= ()=>{
  document.body.classList.toggle('light');
  event.target.textContent = document.body.classList.contains('light')?'ğŸŒ í…Œë§ˆ':'ğŸŒ™ í…Œë§ˆ';
};
generate();

/* â”€â”€â”€ ë³´ë“œ ìƒì„± â”€â”€â”€ */
function generate(){
  clearInterval(tHandle); timer=0; timerDOM.textContent=0;
  firstClick=true; revealed=0; winMessage.style.display='none';
  const diff=diffSelect.value;
  if(diff==='easy'){size=8; mines=10}
  else if(diff==='medium'){size=10; mines=15}
  else {size=12; mines=25}
  board.style.gridTemplateColumns=`repeat(${size},var(--cell-size))`;
  board.style.gridTemplateRows  =`repeat(${size},var(--cell-size))`;
  board.innerHTML=''; cells=[];
  flagsLeft=mines; flagsDOM.textContent=flagsLeft;

  for(let i=0;i<size*size;i++){
    const d=document.createElement('div'); d.className='cell';
    d.dataset.idx=i; board.appendChild(d); cells.push(d);

    /* click / long-press ë¶„ë¦¬  */
    let pressTimer, moved=false;
    d.addEventListener('touchstart',e=>{
      moved=false;
      pressTimer=setTimeout(()=>{toggleFlag(i); moved=true;}, LONG);
    });
    d.addEventListener('touchmove',()=>{clearTimeout(pressTimer); moved=true;});
    d.addEventListener('touchend',e=>{
      if(!moved){ clearTimeout(pressTimer); handleClick(i); }
    });
    /* ë°ìŠ¤í¬í†± */
    d.addEventListener('click', ()=>handleClick(i));
    d.addEventListener('contextmenu',e=>{e.preventDefault(); toggleFlag(i);});
  }
}
function resetGame(){ generate(); }

/* â”€â”€â”€ íƒ€ì´ë¨¸ â”€â”€â”€ */
function startTimer(){
  tHandle=setInterval(()=>{timer++; timerDOM.textContent=timer;},1000);
}

/* â”€â”€â”€ ì§€ë¢° ë°°ì¹˜ (ì²« í´ë¦­ ì•ˆì „) â”€â”€â”€ */
function plantMines(excl){
  const set=new Set();
  while(set.size<mines){
    const r=Math.floor(Math.random()*size*size);
    if(r!==excl) set.add(r);
  }
  set.forEach(i=>cells[i].dataset.mine='1');
}

/* â”€â”€â”€ ì¸ì ‘ ì§€ë¢° ìˆ˜ â”€â”€â”€ */
function adj(x,y){
  let c=0;
  for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++){
    if(dx||dy){
      const nx=x+dx, ny=y+dy;
      if(nx>=0&&ny>=0&&nx<size&&ny<size)
        if(cells[idx(nx,ny)].dataset.mine==='1') c++;
    }
  }
  return c;
}

/* â”€â”€â”€ í´ë¦­ / ì—´ê¸° â”€â”€â”€ */
function handleClick(i){
  const d=cells[i];
  if(d.classList.contains('revealed')||d.classList.contains('flagged'))return;

  if(firstClick){
    plantMines(i); startTimer(); firstClick=false;
  }
  reveal(i);
}

function reveal(i){
  const d=cells[i];
  if(!d||d.classList.contains('revealed')||d.classList.contains('flagged'))return;

  d.classList.add('revealed'); revealed++;

  if(d.dataset.mine==='1'){
    d.classList.add('mine'); d.textContent='ğŸ’£';
    revealMines(); clearInterval(tHandle); alert('ğŸ’¥ ì§€ë¢°! ê²Œì„ ì˜¤ë²„');
    return;
  }
  const x=i%size, y=Math.floor(i/size), n=adj(x,y);
  if(n){ d.textContent=n; }
  else{
    for(let dx=-1;dx<=1;dx++)for(let dy=-1;dy<=1;dy++){
      const nx=x+dx, ny=y+dy;
      if(nx>=0&&ny>=0&&nx<size&&ny<size) reveal(idx(nx,ny));
    }
  }
  if(revealed===size*size-mines){
    winMessage.style.display='block'; clearInterval(tHandle);
  }
}

/* â”€â”€â”€ ê¹ƒë°œ â”€â”€â”€ */
function toggleFlag(i){
  const d=cells[i];
  if(d.classList.contains('revealed'))return;
  if(d.classList.contains('flagged')){
    d.classList.remove('flagged'); d.textContent=''; flagsLeft++;
  }else if(flagsLeft){
    d.classList.add('flagged'); d.textContent='ğŸš©'; flagsLeft--;
  }
  flagsDOM.textContent=flagsLeft;
}

/* â”€â”€â”€ ì „ì²´ ì§€ë¢° í‘œì‹œ â”€â”€â”€ */
function revealMines(){
  cells.forEach(c=>{ if(c.dataset.mine==='1'){c.classList.add('revealed','mine'); c.textContent='ğŸ’£';} });
}
</script>
</body>
</html>
